from rest_framework import permissions

class IsVendorOwnerOrAdmin(permissions.BasePermission):
    """
    ×›×œ×œ×™×:
    ğŸ‘‘ ××©×ª××© ×¢× Role 'admin':     ×™×›×•×œ ×œ×¢×¨×•×š ×›×œ ×¡×¤×§
    ğŸ¢ ×¡×¤×§ (×‘×¢×œ×™×):               ×™×›×•×œ ×œ×¢×¨×•×š ×¨×§ ××ª ×¢×¦××•
    ğŸ‘¤ ××—×¨×™×:                      ×œ× ×™×›×•×œ×™× ×œ×¢×¨×•×š
    """
#×‘×“×™×§×” ×‘×¨××ª ×”××•×‘×™×™×§×˜
    def has_object_permission(self, request, view, obj):

        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        # âœ… ×‘×“×™×§×” 1: ×”×× ×”××©×ª××© ×”×•× ×× ×”×œ? (RBAC)
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        if request.user and request.user.is_authenticated:
            has_admin_role = request.user.user_roles.filter(
                role__name='admin'
            ).exists()

            if has_admin_role:
                return True

        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        # âœ… ×‘×“×™×§×” 2: ×”×× ×”××©×ª××© ×”×•× ×”×‘×¢×œ×™×? (Least Privilege)
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        if request.user and obj.user == request.user:
            return True  # ×‘×¢×œ×™× - ××•×¨×©×” ×œ×¢×¨×•×š ××ª ×¢×¦××• ×‘×œ×‘×“

        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        # âŒ ×‘×¨×™×¨×ª ××—×“×œ: ××¡×•×¨ (Fail Secure)
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        return False